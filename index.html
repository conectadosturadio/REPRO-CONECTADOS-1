<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Conectados Tu Radio</title>
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Inter:wght@300;400;600&display=swap');
      *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
      html,body{
        height:100%;width:100%;
        background:radial-gradient(ellipse at 20% 20%, #1a0533 0%, #0a0a1a 40%, #001a2e 70%, #0a0a1a 100%);
        display:flex;align-items:center;justify-content:center;
        font-family:'Inter',sans-serif;overflow:hidden;
      }
      /* Fondo animado de partículas */
      .bg-particles{position:fixed;inset:0;pointer-events:none;z-index:0;overflow:hidden;}
      .particle{position:absolute;border-radius:50%;animation:floatP linear infinite;opacity:0;}
      @keyframes floatP{0%{transform:translateY(100vh) scale(0);opacity:0}10%{opacity:.6}90%{opacity:.3}100%{transform:translateY(-10vh) scale(1.5);opacity:0}}
      .player-wrap{
        position:relative;z-index:10;
        width:min(320px,90vw);
        background:rgba(10,10,26,0.55);
        border:1px solid rgba(180,100,255,0.25);
        border-radius:1.5rem;
        backdrop-filter:blur(28px) saturate(180%);
        -webkit-backdrop-filter:blur(28px) saturate(180%);
        box-shadow:
          0 0 0 1px rgba(100,200,255,0.08),
          0 0 40px rgba(180,100,255,0.2),
          0 0 80px rgba(0,200,255,0.1),
          inset 0 0 40px rgba(0,0,0,0.4),
          inset 0 1px 0 rgba(255,255,255,0.07);
        overflow:hidden;
      }
      /* Holographic shimmer */
      .shimmer{
        position:absolute;inset:0;pointer-events:none;z-index:0;border-radius:1.5rem;
        background:linear-gradient(135deg,transparent 30%,rgba(180,100,255,0.04) 50%,transparent 70%);
        animation:shimmerAnim 4s ease-in-out infinite;
      }
      @keyframes shimmerAnim{0%,100%{opacity:0;transform:translateX(-100%)}50%{opacity:1;transform:translateX(100%)}}
      /* HEADER */
      .header{
        position:relative;z-index:2;
        display:flex;align-items:center;justify-content:space-between;
        padding:.65rem 1rem;
        border-bottom:1px solid rgba(180,100,255,0.15);
        background:rgba(0,0,0,0.15);
      }
      .live-badge{display:flex;align-items:center;gap:6px;}
      .live-pulse{
        width:8px;height:8px;border-radius:50%;background:#6b7280;
        box-shadow:none;transition:all .3s;
      }
      .live-pulse.on{
        background:#00ff88;
        box-shadow:0 0 8px #00ff88, 0 0 16px #00ff8866;
        animation:pulseLive 1.5s ease-in-out infinite;
      }
      @keyframes pulseLive{0%,100%{transform:scale(1);opacity:1}50%{transform:scale(1.4);opacity:.7}}
      .live-text{font-family:'Orbitron',sans-serif;font-size:.58rem;font-weight:700;color:#4b5563;letter-spacing:.1em;transition:color .3s;}
      .live-text.on{color:#00ff88;text-shadow:0 0 10px #00ff8866;}
      .station-tag{font-size:.65rem;color:rgba(200,180,255,0.7);font-weight:600;letter-spacing:.05em;text-align:right;max-width:110px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
      /* ARTWORK */
      .artwork{
        position:relative;margin:.75rem .85rem 0;
        height:165px;border-radius:1.1rem;overflow:hidden;
        border:1px solid rgba(180,100,255,0.2);
        background:#050510;
      }
      #waveCanvas{position:absolute;inset:0;width:100%;height:100%;}
      #particleCanvas{position:absolute;inset:0;width:100%;height:100%;opacity:.6;}
      .logo-frame{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;z-index:2;}
      .logo-ring{
        padding:3px;border-radius:.85rem;
        background:conic-gradient(from 0deg, #ff006e,#8338ec,#3a86ff,#06ffa5,#ffbe0b,#ff006e);
        animation:spinRing 3s linear infinite;
        box-shadow:0 0 20px rgba(131,56,236,0.5);
      }
      @keyframes spinRing{to{filter:hue-rotate(360deg)}}
      .logo-inner{width:90px;height:90px;border-radius:.75rem;overflow:hidden;background:#111;}
      .logo-inner img{width:100%;height:100%;object-fit:cover;}
      /* corner glows */
      .artwork::before{content:'';position:absolute;top:-20px;left:-20px;width:80px;height:80px;background:radial-gradient(circle,rgba(180,100,255,0.4),transparent);pointer-events:none;z-index:1;}
      .artwork::after{content:'';position:absolute;bottom:-20px;right:-20px;width:80px;height:80px;background:radial-gradient(circle,rgba(0,200,255,0.4),transparent);pointer-events:none;z-index:1;}
      /* TRACK INFO */
      .track-info{padding:.6rem 1rem .25rem;position:relative;z-index:2;}
      .track-title{
        font-family:'Orbitron',sans-serif;font-size:.82rem;font-weight:700;
        color:#fff;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
        text-shadow:0 0 12px rgba(180,100,255,0.5);margin-bottom:2px;
      }
      .track-artist{font-size:.72rem;color:rgba(180,160,220,0.8);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
      /* ECUALIZADOR */
      .eq-wrap{
        display:flex;align-items:flex-end;justify-content:center;gap:3px;
        height:38px;padding:.1rem 1rem 0;position:relative;z-index:2;
      }
      .eq-bar{
        flex:1;max-width:12px;border-radius:2px 2px 0 0;
        background:linear-gradient(to top,#ff006e,#8338ec);
        height:4px;transition:height .12s ease;
        box-shadow:0 0 6px rgba(131,56,236,0.6);
      }
      /* SPECTRUM / WAVEFORM TEXT */
      .spectrum-label{text-align:center;font-family:'Orbitron',sans-serif;font-size:.5rem;letter-spacing:.15em;color:rgba(180,100,255,0.4);padding:.1rem 0 0;position:relative;z-index:2;}
      /* CONTROLS */
      .controls{
        display:flex;align-items:center;justify-content:space-between;
        padding:.55rem 1rem .85rem;position:relative;z-index:2;gap:.4rem;
      }
      .btn-icon{
        background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.08);
        border-radius:50%;width:34px;height:34px;cursor:pointer;
        display:flex;align-items:center;justify-content:center;color:rgba(180,160,220,0.7);
        transition:all .2s;flex-shrink:0;
      }
      .btn-icon:hover{background:rgba(131,56,236,0.2);border-color:rgba(131,56,236,0.5);color:#fff;box-shadow:0 0 12px rgba(131,56,236,0.4);}
      .btn-play{
        width:52px;height:52px;border-radius:50%;border:none;cursor:pointer;
        background:linear-gradient(135deg,#8338ec,#3a86ff,#06ffa5);
        background-size:200% 200%;animation:gradShift 3s ease infinite;
        display:flex;align-items:center;justify-content:center;color:#fff;
        box-shadow:0 0 20px rgba(131,56,236,0.5),0 0 40px rgba(58,134,255,0.3);
        transition:transform .15s,box-shadow .15s;flex-shrink:0;
      }
      .btn-play:hover{transform:scale(1.1);box-shadow:0 0 30px rgba(131,56,236,0.8),0 0 60px rgba(6,255,165,0.3);}
      .btn-play:active{transform:scale(0.93);}
      @keyframes gradShift{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
      .vol-section{display:flex;flex-direction:column;align-items:center;gap:3px;flex:1;}
      .vol-label{font-size:.48rem;font-family:'Orbitron',sans-serif;color:rgba(180,100,255,0.5);letter-spacing:.1em;}
      input[type=range]{
        -webkit-appearance:none;appearance:none;
        width:100%;height:4px;
        background:linear-gradient(to right,#8338ec var(--val,70%),rgba(255,255,255,0.1) var(--val,70%));
        border-radius:2px;cursor:pointer;
      }
      input[type=range]::-webkit-slider-thumb{
        -webkit-appearance:none;width:14px;height:14px;border-radius:50%;
        background:linear-gradient(135deg,#8338ec,#3a86ff);
        box-shadow:0 0 8px rgba(131,56,236,0.8);
      }
      /* FOOTER GLOW LINE */
      .footer-line{height:2px;background:linear-gradient(to right,transparent,#8338ec,#3a86ff,#06ffa5,transparent);opacity:.4;position:relative;z-index:2;}
      /* Scanline overlay */
      .scanlines{position:absolute;inset:0;pointer-events:none;z-index:3;
        background:repeating-linear-gradient(0deg,transparent,transparent 2px,rgba(0,0,0,0.03) 2px,rgba(0,0,0,0.03) 4px);
        border-radius:1.5rem;
      }
    </style>
  </head>
  <body>
    <div class="bg-particles" id="bgParticles"></div>

    <div class="player-wrap">
      <div class="shimmer"></div>
      <div class="scanlines"></div>

      <div class="header">
        <div class="live-badge">
          <div class="live-pulse" id="livePulse"></div>
          <span class="live-text" id="liveText">STANDBY</span>
        </div>
        <span class="station-tag" id="stationTag">CONECTADOS TU RADIO</span>
      </div>

      <div class="artwork">
        <canvas id="particleCanvas"></canvas>
        <canvas id="waveCanvas"></canvas>
        <div class="logo-frame">
          <div class="logo-ring">
            <div class="logo-inner">
              <img src="https://raw.githubusercontent.com/conectadosturadio/imagenes-clientes-web/refs/heads/main/logo%20%20color%20cariobe%20radio.jpeg" alt="Conectados Tu Radio"/>
            </div>
          </div>
        </div>
      </div>

      <div class="track-info">
        <div class="track-title" id="trackTitle">Conectados Tu Radio</div>
        <div class="track-artist" id="trackArtist">Conectando...</div>
      </div>

      <div class="spectrum-label">◈ SPECTRUM ◈</div>
      <div class="eq-wrap" id="eqWrap"></div>

      <div class="controls">
        <button class="btn-icon" id="btnMute" title="Silenciar">
          <svg id="volSvg" width="16" height="16" fill="currentColor" viewbox="0 0 24 24"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02z"/></path></svg>
        </button>
        <button class="btn-play" id="btnPlay">
          <svg id="playIcon" width="22" height="22" fill="currentColor" viewbox="0 0 24 24"><path d="M8 5v14l11-7z"/></path></svg>
        </button>
        <div class="vol-section">
          <span class="vol-label">VOLUME</span>
          <input type="range" id="volSlider" min="0" max="1" step="0.01" value="0.7"/>
        </div>
      </div>
      <div class="footer-line"></div>
    </div>

    <audio id="radioAudio" autoplay preload="none" src="https://panel2.intermediahost.co:8190/stream"></audio>

    <script>
      const audio = document.getElementById('radioAudio');
      const btnPlay = document.getElementById('btnPlay');
      const playIcon = document.getElementById('playIcon');
      const btnMute = document.getElementById('btnMute');
      const volSvg = document.getElementById('volSvg');
      const volSlider = document.getElementById('volSlider');
      const livePulse = document.getElementById('livePulse');
      const liveText = document.getElementById('liveText');
      const trackTitle = document.getElementById('trackTitle');
      const trackArtist = document.getElementById('trackArtist');
      const stationTag = document.getElementById('stationTag');
      const eqWrap = document.getElementById('eqWrap');
      const waveCanvas = document.getElementById('waveCanvas');
      const partCanvas = document.getElementById('particleCanvas');
      const wCtx = waveCanvas.getContext('2d');
      const pCtx = partCanvas.getContext('2d');

      let playing = false, muted = false, vol = 0.7, rafId = null, t0 = Date.now();

      // ── BG PARTICLES ──
      const bgPart = document.getElementById('bgParticles');
      for(let i=0;i<25;i++){
        const d = document.createElement('div');
        d.className='particle';
        const size = Math.random()*4+2;
        const colors = ['#ff006e','#8338ec','#3a86ff','#06ffa5','#ffbe0b','#ff006e88'];
        d.style.cssText=`width:${size}px;height:${size}px;left:${Math.random()*100}%;background:${colors[Math.floor(Math.random()*colors.length)]};box-shadow:0 0 ${size*3}px currentColor;animation-duration:${Math.random()*12+8}s;animation-delay:${Math.random()*10}s;`;
        bgPart.appendChild(d);
      }

      // ── EQ BARS ──
      const NUM_EQ = 18;
      const eqBars = [];
      const EQ_COLORS = [
        'linear-gradient(to top,#ff006e,#ff4d9d)',
        'linear-gradient(to top,#ff4500,#ffbe0b)',
        'linear-gradient(to top,#8338ec,#c77dff)',
        'linear-gradient(to top,#3a86ff,#06ffa5)',
        'linear-gradient(to top,#06ffa5,#3a86ff)',
        'linear-gradient(to top,#ffbe0b,#ff006e)',
      ];
      for(let i=0;i<NUM_EQ;i++){
        const b = document.createElement('div');
        b.className = 'eq-bar';
        b.style.background = EQ_COLORS[i % EQ_COLORS.length];
        eqWrap.appendChild(b);
        eqBars.push(b);
      }

      let eqRaf = null;
      function animateEQ(){
        eqBars.forEach((b,i)=>{
          const h = playing ? Math.random()*30+4 : 4;
          b.style.height = h+'px';
          b.style.boxShadow = playing ? `0 0 6px rgba(131,56,236,0.7)` : 'none';
        });
        if(playing) eqRaf = setTimeout(animateEQ, 120);
        else eqBars.forEach(b=>{ b.style.height='4px'; b.style.boxShadow='none'; });
      }

      // ── FLOATING PARTICLES CANVAS ──
      const pts = Array.from({length:20},()=>({
        x:Math.random()*300, y:Math.random()*165,
        vx:(Math.random()-.5)*.4, vy:(Math.random()-.5)*.4,
        r:Math.random()*2+.5,
        c:['#ff006e','#8338ec','#3a86ff','#06ffa5','#ffbe0b'][Math.floor(Math.random()*5)],
        a:Math.random()*.8+.2
      }));
      function drawParticles(){
        const W=partCanvas.width/devicePixelRatio, H=partCanvas.height/devicePixelRatio;
        pCtx.clearRect(0,0,W*devicePixelRatio,H*devicePixelRatio);
        if(!playing) return;
        pts.forEach(p=>{
          p.x+=p.vx; p.y+=p.vy;
          if(p.x<0||p.x>W) p.vx*=-1;
          if(p.y<0||p.y>H) p.vy*=-1;
          pCtx.save();
          pCtx.globalAlpha=p.a;
          pCtx.beginPath();
          pCtx.arc(p.x*devicePixelRatio,p.y*devicePixelRatio,p.r*devicePixelRatio,0,Math.PI*2);
          pCtx.fillStyle=p.c;
          pCtx.shadowColor=p.c; pCtx.shadowBlur=8*devicePixelRatio;
          pCtx.fill();
          pCtx.restore();
        });
      }

      // ── WAVE CANVAS ──
      function resizeCanvases(){
        [waveCanvas,partCanvas].forEach(c=>{
          const r=c.parentElement.getBoundingClientRect();
          c.width=r.width*devicePixelRatio;
          c.height=r.height*devicePixelRatio;
        });
      }

      function drawWaves(){
        const W=waveCanvas.width, H=waveCanvas.height;
        const w=W/devicePixelRatio, h=H/devicePixelRatio;
        wCtx.clearRect(0,0,W,H);
        drawParticles();
        if(!playing){ rafId=requestAnimationFrame(drawWaves); return; }

        const now=(Date.now()-t0)/1000;
        const waves=[
          {amp:h*.22, freq:.055, speed:1.4, phase:0,    color:['#ff006e','#8338ec'], lw:2},
          {amp:h*.16, freq:.04,  speed:2.1, phase:2.1,  color:['#3a86ff','#06ffa5'], lw:1.5},
          {amp:h*.12, freq:.08,  speed:-.9, phase:1,    color:['#ffbe0b','#ff4500'], lw:1.2},
          {amp:h*.08, freq:.12,  speed:2.8, phase:3.3,  color:['#c77dff','#3a86ff'], lw:1},
        ];

        waves.forEach(wv=>{
          wCtx.save();
          const g=wCtx.createLinearGradient(0,0,W,0);
          g.addColorStop(0,wv.color[0]+'cc');
          g.addColorStop(.5,wv.color[1]+'ff');
          g.addColorStop(1,wv.color[0]+'cc');
          wCtx.strokeStyle=g;
          wCtx.lineWidth=wv.lw*devicePixelRatio;
          wCtx.shadowColor=wv.color[0];
          wCtx.shadowBlur=10*devicePixelRatio;
          wCtx.beginPath();
          for(let x=0;x<w;x++){
            const y=h/2+Math.sin(x*wv.freq+now*wv.speed+wv.phase)*wv.amp
                    +Math.sin(x*wv.freq*.5+now*wv.speed*.7+wv.phase+1)*wv.amp*.4;
            x===0?wCtx.moveTo(x*devicePixelRatio,y*devicePixelRatio):wCtx.lineTo(x*devicePixelRatio,y*devicePixelRatio);
          }
          wCtx.stroke();
          wCtx.restore();
        });

        // Scanline flash
        wCtx.save();
        wCtx.globalAlpha=.04+Math.sin(now*8)*.02;
        wCtx.fillStyle='rgba(180,100,255,1)';
        const scanY=((now*60)%h)*devicePixelRatio;
        wCtx.fillRect(0,scanY,W,1.5*devicePixelRatio);
        wCtx.restore();

        rafId=requestAnimationFrame(drawWaves);
      }

      // ── VOL SLIDER GRADIENT ──
      function updateSliderGrad(){
        volSlider.style.setProperty('--val', (vol*100)+'%');
        volSlider.style.background=`linear-gradient(to right,#8338ec ${vol*100}%,rgba(255,255,255,0.1) ${vol*100}%)`;
      }
      updateSliderGrad();

      // ── SET PLAYING ──
      function setPlaying(state){
        playing=state;
        livePulse.className='live-pulse'+(state?' on':'');
        liveText.className='live-text'+(state?' on':'');
        liveText.textContent=state?'● EN VIVO':'■ PAUSADO';
        playIcon.innerHTML=state
          ?'<path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/>'
          :'<path d="M8 5v14l11-7z"/>';
        if(state){ animateEQ(); }
        else { clearTimeout(eqRaf); setTimeout(()=>eqBars.forEach(b=>{b.style.height='4px';}),200); }
      }

      // ── VOL ICON ──
      function setVolIcon(){
        volSvg.innerHTML=(muted||vol===0)
          ?'<path d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z"/>'
          :'<path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM18.5 12c0 2.77-1.57 5.18-3.9 6.38v2.12c3.37-1.3 5.76-4.54 5.76-8.5 0-3.96-2.39-7.2-5.76-8.5v2.12C16.93 6.82 18.5 9.23 18.5 12z"/>';
      }

      // ── EVENTS ──
      btnPlay.addEventListener('click', async()=>{
        try{
          if(playing){ audio.pause(); setPlaying(false); }
          else{ await audio.play(); setPlaying(true); }
        }catch(e){ console.error(e); }
      });

      volSlider.addEventListener('input', e=>{
        vol=parseFloat(e.target.value);
        audio.volume=vol;
        if(muted&&vol>0){ muted=false; }
        updateSliderGrad(); setVolIcon();
      });

      btnMute.addEventListener('click',()=>{
        muted=!muted;
        audio.volume=muted?0:vol;
        setVolIcon();
      });

      // ── METADATA (Icecast compatible) ──
      async function fetchMeta(){
        try{
          // Intentar obtener metadata del stream de Icecast
          const r=await fetch('https://panel2.intermediahost.co:8190/status-json.xsl');
          const d=await r.json();
          if(d?.icestats?.source){
            const source = Array.isArray(d.icestats.source) ? d.icestats.source[0] : d.icestats.source;
            if(source?.title){
              trackTitle.textContent=source.title;
              trackArtist.textContent=source.server_name || 'En Vivo';
            } else if(source?.server_name){
              trackTitle.textContent=source.server_name;
              trackArtist.textContent='Conectados Tu Radio';
            }
          }
        }catch(e){
          // Fallback: mostrar información genérica
          trackTitle.textContent='Conectados Tu Radio';
          trackArtist.textContent='En Vivo';
        }
      }
      fetchMeta();
      setInterval(fetchMeta,10000);

      // ── INIT ──
      resizeCanvases();
      audio.volume=vol;
      audio.play().then(()=>setPlaying(true)).catch(()=>setPlaying(false));
      drawWaves();
      window.addEventListener('resize',resizeCanvases);
    </script>
  </body>
</html>
